-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")

-- Create ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ESPGui"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = Players.LocalPlayer:WaitForChild("PlayerGui")

-- Main frame
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 180, 0, 120)
MainFrame.Position = UDim2.new(0.8, 0, 0.3, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 6)
MainCorner.Parent = MainFrame

-- Title
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 25)
Title.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
Title.BorderSizePixel = 0
Title.Text = "ESP + FullBright"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 14
Title.Font = Enum.Font.GothamBold
Title.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 6)
TitleCorner.Parent = Title

-- ESP Button
local ESPButton = Instance.new("TextButton")
ESPButton.Size = UDim2.new(0.85, 0, 0, 35)
ESPButton.Position = UDim2.new(0.075, 0, 0.3, 0)
ESPButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
ESPButton.BorderSizePixel = 0
ESPButton.Text = "ESP: OFF"
ESPButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPButton.TextSize = 12
ESPButton.Font = Enum.Font.Gotham
ESPButton.Parent = MainFrame

local ButtonCorner = Instance.new("UICorner")
ButtonCorner.CornerRadius = UDim.new(0, 4)
ButtonCorner.Parent = ESPButton

-- FullBright Button
local FBButton = Instance.new("TextButton")
FBButton.Size = UDim2.new(0.85, 0, 0, 35)
FBButton.Position = UDim2.new(0.075, 0, 0.65, 0)
FBButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
FBButton.BorderSizePixel = 0
FBButton.Text = "FullBright: OFF"
FBButton.TextColor3 = Color3.fromRGB(255, 255, 255)
FBButton.TextSize = 12
FBButton.Font = Enum.Font.Gotham
FBButton.Parent = MainFrame

local FBButtonCorner = Instance.new("UICorner")
FBButtonCorner.CornerRadius = UDim.new(0, 4)
FBButtonCorner.Parent = FBButton

-- ESP Variables
local localPlayer = Players.LocalPlayer
local espEnabled = false
local highlights = {}

-- FullBright Variables
local fbEnabled = false
local normalBrightness = Lighting.Brightness
local normalAmbient = Lighting.Ambient
local fbConnection

-- FullBright Function
local function toggleFullBright()
    fbEnabled = not fbEnabled

    if fbEnabled then
        fbConnection = RunService.RenderStepped:Connect(function()
            Lighting.Brightness = 2
            Lighting.Ambient = Color3.new(1, 1, 1)
            Lighting.ClockTime = 14
        end)
        FBButton.Text = "FullBright: ON"
        FBButton.BackgroundColor3 = Color3.fromRGB(65, 170, 65)
    else
        if fbConnection then fbConnection:Disconnect() fbConnection = nil end
        Lighting.Brightness = normalBrightness
        Lighting.Ambient = normalAmbient
        FBButton.Text = "FullBright: OFF"
        FBButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    end
end

-- Create Highlight for a player
local function addHighlight(player)
    if player.Character and not highlights[player] then
        local highlight = Instance.new("Highlight")
        highlight.FillColor = Color3.fromRGB(255, 0, 0) -- inside fill red
        highlight.OutlineColor = Color3.fromRGB(255, 0, 0) -- outline red
        highlight.FillTransparency = 0.75 -- adjust see-through level
        highlight.OutlineTransparency = 0 -- solid outline
        highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        highlight.Parent = player.Character
        highlights[player] = highlight
    end
end

local function removeHighlight(player)
    if highlights[player] then
        highlights[player]:Destroy()
        highlights[player] = nil
    end
end

-- ESP Toggle
local function toggleESP()
    espEnabled = not espEnabled
    ESPButton.Text = "ESP: " .. (espEnabled and "ON" or "OFF")
    ESPButton.BackgroundColor3 = espEnabled and Color3.fromRGB(65, 170, 65) or Color3.fromRGB(45, 45, 45)

    if espEnabled then
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= localPlayer then
                addHighlight(player)
            end
        end
    else
        for player, _ in pairs(highlights) do
            removeHighlight(player)
        end
    end
end

-- Button Events
ESPButton.MouseButton1Click:Connect(toggleESP)
FBButton.MouseButton1Click:Connect(toggleFullBright)

-- Handle players joining/leaving
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        if espEnabled then
            addHighlight(player)
        end
    end)
end)

Players.PlayerRemoving:Connect(function(player)
    removeHighlight(player)
end)
